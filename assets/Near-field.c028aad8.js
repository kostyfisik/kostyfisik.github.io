import{W as D,ad as z,c as o,_ as Y,aj as b,ak as K,ai as W,X as _,Y as I,ae as j,a7 as i,af as N,a0 as n,a3 as x,m as L,r as ne,aV as X,aQ as Re,aW as ye,aX as Fe,$ as F,a1 as E,ag as ae,q as we,Z as le,a2 as ue,U as _e,aY as xe,aZ as $e,a_ as be,a$ as re,b0 as de,Q as me,w as Ne,b1 as Ue}from"./index.9041cdd0.js";import{Q as We,a as Ie}from"./QCard.ef21fad4.js";import{R as ve,a as H,F as pe,Q as te}from"./ReactiveChart.057ffced.js";import{I as ie,f as se,d as G,Q as Pe}from"./InputWithUnits.28d3e368.js";import{Q as ce,R as qe}from"./RunSimulationSpectrum.8702f255.js";import"./use-dark.1520c919.js";import"./format.ce9ff41f.js";const Ce=D({name:"GetWlFromPlot",components:{ReactiveChart:ve,InputWithUnits:ie},setup(){const e=z(),t=o(()=>e.state.guiRuntime.sourceUnits),r=o({get:()=>e.state.guiRuntime.isShowingHelpForInputWithUnits,set:l=>e.commit("guiRuntime/setIsShowingHelpForInputWithUnits",l)}),c=o({get:()=>b(e.state.simulationSetup.gui.nearFieldSetup.atWL,t.value),set:l=>e.commit("simulationSetup/setNearFieldWL",K(t.value,l))}),p=o(()=>{let l=W.exports.cloneDeep(e.state.plotRuntime.spectrumPlots);return l.layout.yaxis&&(l.layout.yaxis.title="Cross-section"),l.layout.shapes=[{type:"line",x0:c.value,y0:0,x1:c.value,yref:"paper",y1:1,line:{color:"red",width:1.5,dash:"dot"}}],l});function d(l){document.getElementById(l).on("plotly_click",function(u){for(let a=0;a<u.points.length;a++){let v=u.points[a].x;v&&(c.value=parseFloat(v.toString()))}})}return{currentWavelengthInSourceUnits:c,sourceUnits:t,chartContent:p,flexRowTitleStyle:se,isShowingHelpForInputWithUnits:r,manageID:d}}}),ke={class:"row items-baseline"},He={class:"col-xs-12 col-sm-auto text-weight-bold text-center q-pr-md q-py-sm"},Le={class:"col-xs-grow col-sm"},De={class:"row justify-xs-center justify-sm-start items-baseline"},Ye={class:"col-auto"},Te=i("div",{class:"col-auto q-px-sm"},[x(" or "),i("span",{class:"text-bold"},"click on plot"),x(" below to select a data point ")],-1),Ve=i("div",{class:"q-ma-xs"},null,-1);function Xe(e,t,r,c,p,d){const l=_("input-with-units"),s=_("ReactiveChart");return I(),j("div",null,[i("div",ke,[i("div",He,[i("div",{style:N(e.flexRowTitleStyle)},"Source plane wave",4)]),i("div",Le,[i("div",De,[i("div",Ye,[n(l,{"input-result":e.currentWavelengthInSourceUnits,"onUpdate:inputResult":t[0]||(t[0]=u=>e.currentWavelengthInSourceUnits=u),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[1]||(t[1]=u=>e.isShowingHelpForInputWithUnits=u),"initial-expression":e.currentWavelengthInSourceUnits.toString(),units:e.sourceUnits,title:"at"},null,8,["input-result","is-showing-help","initial-expression","units"])]),Te])])]),Ve,n(s,{chart:e.chartContent,"window-height-share":.4,onPlotCreated:t[2]||(t[2]=u=>e.manageID(u))},null,8,["chart"])])}var ze=Y(Ce,[["render",Xe]]);const je=D({name:"GetNearFieldSettings",components:{InputWithUnits:ie},setup(){const e=z(),t=o({get:()=>e.state.guiRuntime.isShowingHelpForInputWithUnits,set:a=>e.commit("guiRuntime/setIsShowingHelpForInputWithUnits",a)}),r=o({get:()=>e.state.simulationSetup.gui.nearFieldSetup.crossSection,set:a=>e.commit("simulationSetup/setNearFieldCrossSection",a)}),c=o({get:()=>e.state.simulationSetup.gui.nearFieldSetup.relativePlotSize,set:a=>e.commit("simulationSetup/setNearFieldRelativePlotSize",a)}),p=o({get:()=>e.state.simulationSetup.gui.nearFieldSetup.plotXSideResolution,set:a=>e.commit("simulationSetup/setNearFieldPlotXSideResolution",Math.floor(a))}),d=o({get:()=>e.state.simulationSetup.gui.nearFieldSetup.plotYSideResolution,set:a=>e.commit("simulationSetup/setNearFieldPlotYSideResolution",Math.floor(a))}),l=o({get:()=>e.state.guiRuntime.plotRatioLabel,set:a=>e.commit("guiRuntime/setPlotRatioLabel",a)}),s=o({get:()=>e.state.guiRuntime.plotRatio,set:a=>e.commit("guiRuntime/setPlotRatio",a)});return L(l,()=>{switch(l.value){case"1:1":s.value=1;break;case"3:2":s.value=2/3;break;case"2:1":s.value=1/2;break;case"fixed":s.value=d.value/p.value;break}}),L([p,l,s],()=>{l.value!="any"&&(d.value=s.value*p.value)}),{hover:ne(!1),crossSection:r,plotRatioLabel:l,isShowingHelpForInputWithUnits:t,flexRowTitleStyle:se,relativePlotSize:c,plotXSideResolution:p,plotYSideResolution:d,nearFieldPlane:X,beforeScale(a){console.log(a.offsetHeight)}}}}),Se=e=>(ye("data-v-f9ef9f22"),e=e(),Fe(),e),Ae={class:"row items-baseline"},Ee={class:"col-xs-12 col-sm-auto text-weight-bold text-center q-pr-md q-py-sm"},Ge={class:"col-xs-grow col-sm"},Ze={class:"row justify-center items-baseline"},Me={class:"col-auto text-center q-py-xs q-pr-md"},Be={class:"col-xs-grow col-sm"},Qe={class:"row justify-xs-center justify-sm-start items-center"},Oe={class:"col-auto"},Je=Se(()=>i("div",{class:"q-ma-xs"},null,-1)),Ke={class:"row justify-center items-center"},et={class:"col-auto text-center q-py-xs q-pr-md"},tt={class:"col-xs-grow col-sm"},it={class:"row justify-xs-center justify-sm-start items-center"},st={class:"q-gutter-md q-py-sm q-px-xs"},ot={class:"collapsible"},lt={class:"row justify-center items-baseline row--slide-transition"},nt={class:"col-auto text-center q-py-xs q-pr-md"},at={class:"col-xs-grow col-sm"},ut={class:"row justify-xs-center justify-sm-start items-center"},rt={class:"row justify-center items-baseline"},dt={class:"col-auto text-center q-py-xs q-pr-md"},mt={class:"col-xs-grow col-sm"},pt={class:"row justify-xs-center justify-sm-start items-center"},ct=Se(()=>i("div",{class:"q-ma-xs"},null,-1)),vt={class:"row justify-center items-center"},St={class:"col-auto text-center q-py-xs q-pr-md"},gt={class:"col-xs-grow col-sm"},ht={class:"row justify-xs-center justify-sm-start items-center"},ft={class:"q-gutter-md q-py-sm q-px-xs"};function Rt(e,t,r,c,p,d){const l=_("input-with-units");return I(),j("div",Ae,[i("div",Ee,[i("div",{style:N(e.flexRowTitleStyle)},"Plot",4)]),i("div",Ge,[i("div",Ze,[i("div",Me,[i("div",{style:N(e.flexRowTitleStyle)},"x-side resolution",4)]),i("div",Be,[i("div",Qe,[i("div",Oe,[n(l,{"input-result":e.plotXSideResolution,"onUpdate:inputResult":t[0]||(t[0]=s=>e.plotXSideResolution=s),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[1]||(t[1]=s=>e.isShowingHelpForInputWithUnits=s),"initial-expression":e.plotXSideResolution.toString(),title:"points",units:""},null,8,["input-result","is-showing-help","initial-expression"])])])])]),Je,i("div",Ke,[i("div",et,[i("div",{style:N(e.flexRowTitleStyle),onClick:t[2]||(t[2]=s=>e.hover=!e.hover)},"ratio",4)]),i("div",tt,[i("div",it,[i("div",st,[n(H,{modelValue:e.plotRatioLabel,"onUpdate:modelValue":t[3]||(t[3]=s=>e.plotRatioLabel=s),dense:"",size:"sm",val:"any",label:"any"},null,8,["modelValue"]),n(H,{modelValue:e.plotRatioLabel,"onUpdate:modelValue":t[4]||(t[4]=s=>e.plotRatioLabel=s),dense:"",size:"sm",val:"fixed",label:"fixed"},null,8,["modelValue"]),n(H,{modelValue:e.plotRatioLabel,"onUpdate:modelValue":t[5]||(t[5]=s=>e.plotRatioLabel=s),dense:"",size:"sm",val:"1:1",label:"1:1"},null,8,["modelValue"]),n(H,{modelValue:e.plotRatioLabel,"onUpdate:modelValue":t[6]||(t[6]=s=>e.plotRatioLabel=s),dense:"",size:"sm",val:"3:2",label:"3:2"},null,8,["modelValue"]),n(H,{modelValue:e.plotRatioLabel,"onUpdate:modelValue":t[7]||(t[7]=s=>e.plotRatioLabel=s),dense:"",size:"sm",val:"2:1",label:"2:1"},null,8,["modelValue"])])])])]),i("div",{class:Re(["collapsible-wrapper",{collapsed:e.plotRatioLabel!="any"||e.hover}])},[i("div",ot,[i("div",lt,[i("div",nt,[i("div",{style:N(e.flexRowTitleStyle)},"y-side resolution",4)]),i("div",at,[i("div",ut,[n(l,{"input-result":e.plotYSideResolution,"onUpdate:inputResult":t[8]||(t[8]=s=>e.plotYSideResolution=s),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[9]||(t[9]=s=>e.isShowingHelpForInputWithUnits=s),"initial-expression":e.plotYSideResolution.toString(),"is-info-mode":e.plotRatioLabel!="any",title:"points",units:""},null,8,["input-result","is-showing-help","initial-expression","is-info-mode"])])])])])],2),i("div",rt,[i("div",dt,[i("div",{style:N(e.flexRowTitleStyle)},"relative side length",4)]),i("div",mt,[i("div",pt,[n(l,{"input-result":e.relativePlotSize,"onUpdate:inputResult":t[10]||(t[10]=s=>e.relativePlotSize=s),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[11]||(t[11]=s=>e.isShowingHelpForInputWithUnits=s),"initial-expression":e.relativePlotSize.toString(),title:"\u{1D43F}\u2009/\u200A\u{1D7D0}\u{1D445}",units:""},null,8,["input-result","is-showing-help","initial-expression"])])])]),ct,i("div",vt,[i("div",St,[i("div",{style:N(e.flexRowTitleStyle)},"cross-section",4)]),i("div",gt,[i("div",ht,[i("div",ft,[n(H,{modelValue:e.crossSection,"onUpdate:modelValue":t[12]||(t[12]=s=>e.crossSection=s),dense:"",size:"sm",val:e.nearFieldPlane.Ek,label:"Ek"},null,8,["modelValue","val"]),n(H,{modelValue:e.crossSection,"onUpdate:modelValue":t[13]||(t[13]=s=>e.crossSection=s),dense:"",size:"sm",val:e.nearFieldPlane.Hk,label:"Hk"},null,8,["modelValue","val"]),n(H,{modelValue:e.crossSection,"onUpdate:modelValue":t[14]||(t[14]=s=>e.crossSection=s),dense:"",size:"sm",val:e.nearFieldPlane.EH,label:"EH"},null,8,["modelValue","val"])])])])])])])}var yt=Y(je,[["render",Rt],["__scopeId","data-v-f9ef9f22"]]);const Ft=D({name:"SaveSimulationNearField",setup(){const e=z(),t=o({get:()=>e.state.guiRuntime.isSaveWithPythonScript,set:a=>e.commit("guiRuntime/setIsSaveWithPythonScript",a)}),r=o(()=>e.state.plotRuntime.nearFieldCoordX),c=o(()=>e.state.plotRuntime.nearFieldCoordY),p=o(()=>e.state.plotRuntime.nearFieldEabs),d=o(()=>e.state.simulationSetup.current.layers.map(a=>a.layerWidth)),l=o(()=>{let a=e.state.simulationSetup.current.nearFieldSetup.crossSection;return a==0?"Ek":a==1?"Hk":"EH"}),s=o(()=>{let a=0,v="";for(let m of d.value)a+=m,v+=a.toString()+",";return v}),u=o(()=>e.state.guiRuntime.units);return{data:p,isSaveWithPythonScript:t,saveSpectrumSimulation(){if(!p.value)return;const a=`# You can open and plot this file using Python
# (without manually removing this header, it will be skipped), see example below.
import numpy as np
from matplotlib import pyplot as plt
data = np.genfromtxt('scattnlay-near-field.txt', names=True, delimiter=', ')
x = data[data.dtype.names[0]] # x-axis has units
y = data[data.dtype.names[1]] # x-axis has units
x_size = len(np.unique(x))
y_size = len(np.unique(y))
x_min = np.min(x)
y_min = np.min(y)
x_max = np.max(x)
y_max = np.max(y)
dx = (x_max-x_min)/(x_size-1)
dy = (y_max-y_min)/(y_size-1)
Eabs = data['Eabs'].reshape((y_size,x_size))

plt.figure()
plt.imshow(Eabs, cmap='jet', origin='lower',
           extent=(x_min-dx/2, x_max+dx/2, y_min-dy/2, y_max+dy/2))
cbar = plt.colorbar(shrink=0.7)
cbar.ax.set_title(r'$|E|/|E_0|$')
plt.xlabel(data.dtype.names[0].replace('_',', '))
plt.ylabel(data.dtype.names[1].replace('_',', '))
fig = plt.gcf()
ax = fig.gca()
radii = [`+s.value+`]
for r in radii:
    ax.add_patch(plt.Circle((0, 0), r, color='w', alpha=0.7, lw=3, fill=False))
plt.title('`+l.value+` cross-section')
plt.show()

`;let v="# X ["+u.value.toString()+"] , Y ["+u.value.toString()+`], Eabs
`,m="";for(let R=0;R<p.value.length;++R){let U=r.value[R].toString()+", "+c.value[R].toString()+", "+p.value[R].toString();U+=`
`,m+=U}const g=new Blob([v+m],{type:"text/plain;charset=utf-8",endings:"native"});pe.exports.saveAs(g,"scattnlay-near-field.txt");const q=new Blob([a],{type:"text/plain;charset=utf-8",endings:"native"});pe.exports.saveAs(q,"scattnlay-near-field-plot.py")}}}});function wt(e,t,r,c,p,d){return I(),j(ae,null,[n(E,{color:"primary","no-caps":"",disable:!e.data,onClick:e.saveSpectrumSimulation},{default:F(()=>[x("Save")]),_:1},8,["disable","onClick"]),n(te,{modelValue:e.isSaveWithPythonScript,"onUpdate:modelValue":t[0]||(t[0]=l=>e.isSaveWithPythonScript=l),size:"sm"},{default:F(()=>[x("Include *.py plotting script")]),_:1},8,["modelValue"])],64)}var _t=Y(Ft,[["render",wt]]);const xt=D({name:"RunSimulationNearField",components:{SaveSimulationNearField:_t},setup(){const e=z(),t=o({get:()=>e.state.guiRuntime.isAutoRefineNearField,set:h=>e.commit("guiRuntime/setIsAutoRefineNearField",h)}),r=o({get:()=>e.state.simulationSetup.nmies.nearField.isNmieRunning,set:h=>{h?e.commit("simulationSetup/markNmieNearFieldAsStarted"):e.commit("simulationSetup/markNmieNearFieldAsFinished")}}),c=o(()=>e.state.simulationSetup.nmies.nearField.instance),p=o(()=>e.state.simulationSetup.current.nearFieldSetup.atWL);function d(){if(!c.value){console.log("Nmie was not loaded yet");return}if(r.value){console.log("Some Nmie is already running!");return}r.value=!0,setTimeout(()=>{we(()=>{e.commit("simulationSetup/copySetupFromGuiToCurrent");const h=e.state.simulationSetup.current.hostIndex,$=W.exports.cloneDeep(e.state.simulationSetup.current.nearFieldSetup),S=$.plotXSideResolution,y=$.plotYSideResolution,f=$.relativePlotSize,C=$.crossSection,k=$.atRelativeX0,V=$.atRelativeY0,A=$.atRelativeZ0,ee=1;try{if(!e.state.simulationSetup.nmies.nearField.instance)throw"ERROR! Scattnlay module was not loaded";const w=e.state.simulationSetup.nmies.nearField.instance,oe=W.exports.cloneDeep(e.state.simulationSetup.current.layers),ge=performance.now();w.SetWavelength(p.value),w.ClearTarget();for(const P of oe)P.material.nSpline&&(P.n=P.material.nSpline.at(p.value)),P.material.kSpline&&(P.k=P.material.kSpline.at(p.value)),w.AddTargetLayerReIm(P.layerWidth*h,P.n/h,P.k/h);w.SetModeNmaxAndType(-1,-1),w.RunFieldCalculationCartesian(y,S,f,C,k,V,A,ee);const he=w.GetFieldEabs();e.commit("plotRuntime/setNearField",he);const fe=(performance.now()-ge)/1e3;e.commit("simulationSetup/setNmieNearFieldTotalRunTime",fe)}catch(w){console.log("Some error:",w)}r.value=!1})},100)}d();const l=o(()=>e.state.simulationSetup.current.layers.map(h=>h.layerWidth)),s=o(()=>l.value.reduce((h,$)=>h+$,0)),u=o(()=>e.state.guiRuntime.nearFieldZoom),a=o(()=>e.state.simulationSetup.current.nearFieldSetup.crossSection),v=o(()=>(u.value.fromX+u.value.toX)/2/s.value),m=o(()=>(u.value.fromY+u.value.toY)/2/s.value),g=o(()=>(u.value.toX-u.value.fromX)/s.value),q=o(()=>(u.value.toY-u.value.fromY)/s.value),R=o(()=>e.state.simulationSetup.gui.nearFieldSetup.plotXSideResolution),U=o(()=>e.state.simulationSetup.gui.nearFieldSetup.plotYSideResolution),Z=o(()=>R.value*U.value);let M=W.exports.cloneDeep(e.state.simulationSetup.current.nearFieldSetup),T=W.exports.cloneDeep(e.state.simulationSetup.current.nearFieldSetup);function B(h,$){const S=Object.keys(h);for(let y of S)if(h[y]!=$[y])return!1;return!0}function Q(){const h=W.exports.cloneDeep(e.state.simulationSetup.current.nearFieldSetup);B(h,M)||(T=W.exports.cloneDeep(h)),!(g.value==0||q.value==0)&&(e.commit("guiRuntime/setPlotRatioLabel","fixed"),e.commit("guiRuntime/setPlotRatio",q.value/g.value),e.commit("simulationSetup/setNearFieldRelativePlotSize",g.value/2),e.commit("simulationSetup/setNearFieldPlotXSideResolution",W.exports.floor(Math.sqrt(Z.value*g.value/q.value))),e.commit("simulationSetup/setNearFieldPlotYSideResolution",W.exports.floor(e.state.guiRuntime.plotRatio*e.state.simulationSetup.gui.nearFieldSetup.plotXSideResolution)),a.value==X.Ek&&(e.commit("simulationSetup/setNearFieldAtRelativeZ0",v.value),e.commit("simulationSetup/setNearFieldAtRelativeX0",m.value)),a.value==X.Hk&&(e.commit("simulationSetup/setNearFieldAtRelativeZ0",v.value),e.commit("simulationSetup/setNearFieldAtRelativeY0",m.value)),a.value==X.EH&&(e.commit("simulationSetup/setNearFieldAtRelativeY0",v.value),e.commit("simulationSetup/setNearFieldAtRelativeX0",m.value)),M=W.exports.cloneDeep(e.state.simulationSetup.gui.nearFieldSetup),d())}L([v,m,g,q],()=>{!t.value||Q()});let O=0;L([R,U],()=>{U.value*R.value>150*150&&O==0&&(t.value=!1,O=1)});const J=ne(!0);return{isUnusedReset:J,isRunning:r,isNmieLoaded:c,runNearFieldSimulation:d,refineOnZoom:Q,isAutoRefineNearField:t,resetZoom(){J.value=!1,e.commit("simulationSetup/setNearFieldSetup",T),e.commit("guiRuntime/setPlotRatio",T.plotYSideResolution/T.plotXSideResolution),d()}}}}),$t={class:"row items-baseline"},bt={class:"col-xs-12 col-sm-auto text-weight-bold text-center q-px-md q-py-sm"},Nt=i("br",null,null,-1),Ut={class:"col-xs-grow col-sm q-px-xs"},Wt={class:"row justify-xs-center justify-sm-start items-baseline"},It={class:"col-auto"},Pt={class:"row items-baseline"},qt={class:"col-xs-12 col-sm-auto text-weight-bold text-center q-px-md q-py-sm"},Ct={class:"col-xs-grow col-sm q-px-xs"},kt={class:"row justify-xs-center justify-sm-start items-baseline"},Ht={class:"col-auto"},Lt={class:"col-auto q-px-sm"};function Dt(e,t,r,c,p,d){const l=_("SaveSimulationNearField");return I(),j(ae,null,[i("div",$t,[i("div",bt,[e.$store.state.guiRuntime.safeFromWL>e.$store.state.simulationSetup.gui.nearFieldSetup.atWL||e.$store.state.guiRuntime.safeToWL<e.$store.state.simulationSetup.gui.nearFieldSetup.atWL?(I(),le(G,{key:0,anchor:"top middle",self:"center middle",class:"bg-amber-4 text-black shadow-4"},{default:F(()=>[x(" Will use materials"),Nt,x(" spectrum range. ")]),_:1})):ue("",!0),n(E,{loading:e.isRunning,disable:e.isRunning||!e.isNmieLoaded,color:"primary","no-caps":"",label:e.isNmieLoaded?"Run simulation":"Loading...",onClick:e.runNearFieldSimulation},{loading:F(()=>[n(ce)]),_:1},8,["loading","disable","label","onClick"])]),i("div",Ut,[i("div",Wt,[i("div",It,[n(l)])])])]),i("div",Pt,[i("div",qt,[n(E,{loading:e.isRunning,disable:e.isRunning||!e.isNmieLoaded,color:"primary","no-caps":"",label:e.isNmieLoaded?"Refine zoomed region":"Loading...",onClick:e.refineOnZoom},{loading:F(()=>[n(ce)]),_:1},8,["loading","disable","label","onClick"])]),i("div",Ct,[i("div",kt,[i("div",Ht,[n(te,{modelValue:e.isAutoRefineNearField,"onUpdate:modelValue":t[0]||(t[0]=s=>e.isAutoRefineNearField=s),size:"sm"},{default:F(()=>[x(" auto refine ")]),_:1},8,["modelValue"])]),i("div",Lt,[e.isUnusedReset?(I(),le(G,{key:0,anchor:"top middle",self:"center middle"},{default:F(()=>[x(" to previous 'Run simulation' button click")]),_:1})):ue("",!0),n(E,{"no-caps":"",flat:"",icon:"restart_alt",color:"primary",label:"reset",onClick:t[1]||(t[1]=s=>e.resetZoom())})])])])])],64)}var Yt=Y(xt,[["render",Dt]]);const Tt=D({name:"PlotNearField",components:{ReactiveChart:ve},setup(){const e=z(),r=_e({data:[],layout:{shapes:[],margin:{l:0,r:40,b:50,t:30},xaxis:{title:""},yaxis:{scaleanchor:"x",title:""},showlegend:!1},config:{responsive:!0,displaylogo:!1}}),c=o(()=>e.state.simulationSetup.current.nearFieldSetup.crossSection),p=o(()=>e.state.simulationSetup.current.nearFieldSetup.relativePlotSize),d=o(()=>e.state.simulationSetup.current.nearFieldSetup.plotYSideResolution),l=o(()=>e.state.simulationSetup.current.nearFieldSetup.plotXSideResolution),s=o(()=>e.state.simulationSetup.current.layers.map(S=>S.layerWidth)),u=o(()=>s.value.reduce((S,y)=>S+y,0)),a=o(()=>u.value*p.value),v=o(()=>a.value*2/(l.value-1)),m=o(()=>e.state.guiRuntime.units),g=o(()=>c.value==X.Ek||c.value==X.Hk?e.state.simulationSetup.current.nearFieldSetup.atRelativeZ0:e.state.simulationSetup.current.nearFieldSetup.atRelativeY0),q=o(()=>c.value==X.Hk?e.state.simulationSetup.current.nearFieldSetup.atRelativeY0:e.state.simulationSetup.current.nearFieldSetup.atRelativeX0),R=o(()=>{let S=[],y=[];const f=g.value*u.value-v.value*(l.value-1)/2,C=q.value*u.value-v.value*(d.value-1)/2;for(let k=0;k<d.value;++k)for(let V=0;V<l.value;++V)S.push(b(f+V*v.value,m.value)),y.push(b(C+k*v.value,m.value));return e.commit("plotRuntime/setNearFieldCoords",{x:S,y}),{x:S,y}}),U=o(()=>e.state.plotRuntime.nearFieldLimitFrom),Z=o(()=>e.state.plotRuntime.nearFieldLimitTo),M=o(()=>e.state.plotRuntime.nearFieldDataFrom),T=o(()=>e.state.plotRuntime.nearFieldDataTo),B=o(()=>{let S=e.state.plotRuntime.nearFieldEabs;return e.commit("plotRuntime/setNearFieldDataTo",xe(S)),e.commit("plotRuntime/setNearFieldDataFrom",$e(S)),e.commit("plotRuntime/setNearFieldLimitTo",e.state.plotRuntime.nearFieldDataTo),e.commit("plotRuntime/setNearFieldLimitFrom",e.state.plotRuntime.nearFieldDataFrom),S}),Q=o(()=>e.state.guiRuntime.isLogColorscale),O=o(()=>{if(!B.value)return B.value;const S=be(B.value,U.value,Z.value);return Q.value?S.map(y=>Math.log10(y)):S}),J=o(()=>e.state.guiRuntime.colorscale);L([O,R,J],()=>{r.data.length=0;let S={type:"heatmap",colorscale:J.value,colorbar:{title:"|\u{1D438}|\u2215|\u{1D438}\u{1D70A}|"},z:O.value};if(Q.value){const C=Math.log10(U.value>M.value?U.value:M.value),k=Math.log10(Z.value<T.value?Z.value:T.value),V=(k-C)/4;let A=[];for(let w=0;w<4;++w){let oe=C+w*V;A.push(oe)}A.push(k);let ee=[];for(let w of A)ee.push(Math.pow(10,w).toFixed(2));S.colorbar={title:"|\u{1D438}|\u2215|\u{1D438}\u{1D70A}|",tickmode:"array",tickvals:A,ticktext:ee}}r.data.push({...R.value,...S});const y=re(R.value.x)<-b(u.value,m.value)&&de(R.value.x)>b(u.value,m.value)&&re(R.value.y)<-b(u.value,m.value)&&de(R.value.y)>b(u.value,m.value);if(r.layout.shapes&&(r.layout.shapes.length=0),r.layout.shapes&&y){let f=0;for(let C of s.value)f+=C,r.layout.shapes.push({type:"circle",xref:"x",yref:"y",x0:b(-f,m.value),y0:b(-f,m.value),x1:b(f,m.value),y1:b(f,m.value),line:{color:"rgba(235, 235, 235, 0.8)",width:3}})}});const h=o(()=>"x ["+m.value+"]");r.layout.xaxis&&(r.layout.xaxis.title=h.value),L(h,()=>{r.layout.xaxis&&(r.layout.xaxis.title=h.value)});function $(S){document.getElementById(S).on("plotly_relayout",function(f){f["xaxis.range[0]"]&&f["xaxis.range[1]"]&&f["yaxis.range[0]"]&&f["yaxis.range[1]"]?e.commit("guiRuntime/setNearFieldZoom",{fromX:K(m.value,f["xaxis.range[0]"]),toX:K(m.value,f["xaxis.range[1]"]),fromY:K(m.value,f["yaxis.range[0]"]),toY:K(m.value,f["yaxis.range[1]"])}):e.commit("guiRuntime/setNearFieldZoom",{fromX:0,toX:0,fromY:0,toY:0})})}return{nearFieldPlot:r,totalR:u,manageID:$}}});function Vt(e,t,r,c,p,d){const l=_("ReactiveChart");return I(),j("div",null,[n(l,{chart:e.nearFieldPlot,onPlotCreated:t[0]||(t[0]=s=>e.manageID(s))},null,8,["chart"])])}var Xt=Y(Tt,[["render",Vt]]);const zt=D({name:"GetNearFieldColorScale",components:{InputWithUnits:ie},setup(){const e=z(),t=o({get:()=>e.state.guiRuntime.colorscale,set:g=>e.commit("guiRuntime/setColorscale",g)}),r=o({get:()=>e.state.guiRuntime.isLogColorscale,set:g=>e.commit("guiRuntime/setIsLogColorscale",g)}),c=ne(!1),p=["Jet","Portland","Hot","Greys","Greens"],d=["YlOrRd","YlGnBu","RdBu","Electric","Earth","Picnic","Bluered","Blackbody"],l=o(()=>c.value?[...p,...d]:p),s=o({get:()=>e.state.guiRuntime.isShowingHelpForInputWithUnits,set:g=>e.commit("guiRuntime/setIsShowingHelpForInputWithUnits",g)}),u=o(()=>e.state.plotRuntime.nearFieldDataFrom),a=o(()=>e.state.plotRuntime.nearFieldDataTo),v=o({get:()=>e.state.plotRuntime.nearFieldLimitFrom,set:g=>e.commit("plotRuntime/setNearFieldLimitFrom",g)}),m=o({get:()=>e.state.plotRuntime.nearFieldLimitTo,set:g=>e.commit("plotRuntime/setNearFieldLimitTo",g)});return v.value=u.value,m.value=a.value,L(u,()=>{u.value>v.value&&(v.value=u.value)}),L(a,()=>{a.value<m.value&&(m.value=a.value)}),{isShowingHelpForInputWithUnits:s,flexRowTitleStyle:se,limitFrom:v,limitTo:m,resetLimits(){m.value=a.value,v.value=u.value},colorscale:t,moreColors:c,colorscaleOptions:l,isLogColorscale:r}}}),jt={class:"row items-baseline"},At={class:"col-xs-12 col-sm-auto text-center q-px-md q-py-sm"},Et={class:"col-xs-grow col-sm"},Gt={class:"row justify-xs-center justify-sm-start items-center"},Zt={class:"col-auto"},Mt={class:"col-auto"},Bt={class:"col-auto q-pa-xs"},Qt=i("div",{class:"q-ma-xs"},null,-1),Ot={class:"row items-baseline"},Jt={class:"col-xs-12 col-sm-auto text-center q-px-md q-py-sm"},Kt={class:"col-xs-grow col-sm"},ei={class:"row justify-xs-center justify-sm-start items-center"},ti={class:"col-auto"},ii={class:"col-auto q-mx-sm"},si={class:"col-auto"},oi={class:"q-px-sm"},li={href:"https://www.semanticscholar.org/paper/Why-We-Use-Bad-Color-Maps-and-What-You-Can-Do-About-Moreland/028423bb486b2a963ee6a330ea5cceab467a5349"};function ni(e,t,r,c,p,d){const l=_("input-with-units");return I(),j(ae,null,[i("div",jt,[i("div",At,[i("div",{style:N(e.flexRowTitleStyle)}," |\u2009\u{1D438}\u2009|\u2004\u2215\u2004|\u2009\u{1D438}\u{1D70A}\u2009| ",4)]),i("div",Et,[i("div",Gt,[i("div",Zt,[n(l,{"input-result":e.limitFrom,"onUpdate:inputResult":t[0]||(t[0]=s=>e.limitFrom=s),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[1]||(t[1]=s=>e.isShowingHelpForInputWithUnits=s),"initial-expression":e.limitFrom.toString(),title:"from",units:""},null,8,["input-result","is-showing-help","initial-expression"])]),i("div",Mt,[n(l,{"input-result":e.limitTo,"onUpdate:inputResult":t[2]||(t[2]=s=>e.limitTo=s),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[3]||(t[3]=s=>e.isShowingHelpForInputWithUnits=s),"initial-expression":e.limitTo.toString(),title:"to",units:""},null,8,["input-result","is-showing-help","initial-expression"])]),i("div",Bt,[n(E,{"no-caps":"",flat:"",icon:"restart_alt",color:"primary",label:"reset",onClick:t[4]||(t[4]=s=>e.resetLimits())})])])])]),Qt,i("div",Ot,[i("div",Jt,[i("div",{style:N(e.flexRowTitleStyle)},null,4)]),i("div",Kt,[i("div",ei,[i("div",ti,[n(te,{modelValue:e.isLogColorscale,"onUpdate:modelValue":t[5]||(t[5]=s=>e.isLogColorscale=s),size:"sm"},{default:F(()=>[x(" use log scale ")]),_:1},8,["modelValue"])]),i("div",ii,[n(Pe,{modelValue:e.colorscale,"onUpdate:modelValue":t[6]||(t[6]=s=>e.colorscale=s),options:e.colorscaleOptions,"options-dense":"",outlined:"",dense:""},null,8,["modelValue","options"])]),i("div",si,[n(te,{modelValue:e.moreColors,"onUpdate:modelValue":t[7]||(t[7]=s=>e.moreColors=s),size:"sm"},{default:F(()=>[x(" use more colors ")]),_:1},8,["modelValue"]),i("span",oi,[n(G,{anchor:"top middle",self:"center middle"},{default:F(()=>[x(" more on color preception "),n(me,{name:"launch"})]),_:1}),i("a",li,[n(me,{name:"o_info",size:"sm"})])])])])])])],64)}var ai=Y(zt,[["render",ni]]);const ui=D({name:"GetNearFieldRefinedSettings",components:{InputWithUnits:ie},setup(){const e=z(),t=o({get:()=>e.state.guiRuntime.isShowingHelpForInputWithUnits,set:d=>e.commit("guiRuntime/setIsShowingHelpForInputWithUnits",d)}),r=o({get:()=>e.state.simulationSetup.gui.nearFieldSetup.atRelativeX0,set:d=>e.commit("simulationSetup/setNearFieldAtRelativeX0",d)}),c=o({get:()=>e.state.simulationSetup.gui.nearFieldSetup.atRelativeY0,set:d=>e.commit("simulationSetup/setNearFieldAtRelativeY0",d)}),p=o({get:()=>e.state.simulationSetup.gui.nearFieldSetup.atRelativeZ0,set:d=>e.commit("simulationSetup/setNearFieldAtRelativeZ0",d)});return{isShowingHelpForInputWithUnits:t,flexRowTitleStyle:se,atRelativeX0:r,atRelativeY0:c,atRelativeZ0:p}}}),ri={class:"row items-baseline"},di={class:"col-xs-12 col-sm-auto text-weight-bold text-center q-pr-md q-py-sm"},mi={class:"col-xs-grow col-sm"},pi={class:"row justify-center items-baseline"},ci={class:"col-auto text-center q-py-xs q-pr-md"},vi={class:"col-xs-grow col-sm"},Si={class:"row justify-xs-center justify-sm-start items-center"},gi={class:"col-auto"},hi={class:"col-auto"},fi={class:"col-auto"},Ri=i("div",{class:"q-ma-xs"},null,-1);function yi(e,t,r,c,p,d){const l=_("input-with-units");return I(),j("div",ri,[i("div",di,[i("div",{style:N(e.flexRowTitleStyle)},"Plot",4)]),i("div",mi,[i("div",pi,[i("div",ci,[i("div",{style:N(e.flexRowTitleStyle)},"relative center",4)]),i("div",vi,[i("div",Si,[i("div",gi,[n(G,{anchor:"center start",self:"center end"},{default:F(()=>[x(" E-field vector direction ")]),_:1}),n(l,{"input-result":e.atRelativeX0,"onUpdate:inputResult":t[0]||(t[0]=s=>e.atRelativeX0=s),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[1]||(t[1]=s=>e.isShowingHelpForInputWithUnits=s),"initial-expression":e.atRelativeX0.toString(),title:"\u{1D44B}\u{1D45C}\u2009/\u200A\u{1D445}",units:""},null,8,["input-result","is-showing-help","initial-expression"])]),i("div",hi,[n(G,{anchor:"center start",self:"center end"},{default:F(()=>[x(" H-field vector direction ")]),_:1}),n(l,{"input-result":e.atRelativeY0,"onUpdate:inputResult":t[2]||(t[2]=s=>e.atRelativeY0=s),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[3]||(t[3]=s=>e.isShowingHelpForInputWithUnits=s),"initial-expression":e.atRelativeY0.toString(),title:"\u{1D44C}\u{1D45C}\u2009/\u200A\u{1D445}",units:""},null,8,["input-result","is-showing-help","initial-expression"])]),i("div",fi,[n(G,{anchor:"center start",self:"center end"},{default:F(()=>[x(" k-vector direction ")]),_:1}),n(l,{"input-result":e.atRelativeZ0,"onUpdate:inputResult":t[4]||(t[4]=s=>e.atRelativeZ0=s),"is-showing-help":e.isShowingHelpForInputWithUnits,"onUpdate:isShowingHelp":t[5]||(t[5]=s=>e.isShowingHelpForInputWithUnits=s),"initial-expression":e.atRelativeZ0.toString(),title:"\u{1D44D}\u{1D45C}\u2009/\u200A\u{1D445}",units:""},null,8,["input-result","is-showing-help","initial-expression"])])])])]),Ri])])}var Fi=Y(ui,[["render",yi]]);const wi=D({name:"NearField",components:{GetNearFieldRefinedSettings:Fi,GetNearFieldColorScale:ai,PlotNearField:Xt,RunSimulationNearField:Yt,GetWlFromPlot:ze,RunSimulationSpectrum:qe,GetNearFieldSettings:yt},setup(){return{}}}),_i=i("div",{class:"q-ma-md"},null,-1),xi=i("div",{class:"q-ma-xs"},null,-1),$i=i("div",{class:"q-ma-xs"},null,-1),bi=i("div",{class:"q-ma-xs"},null,-1),Ni=i("div",{class:"q-ma-xs"},null,-1),Ui=i("div",{class:"q-ma-xs"},null,-1),Wi=i("div",{class:"q-ma-lg"},null,-1);function Ii(e,t,r,c,p,d){const l=_("RunSimulationSpectrum"),s=_("GetWlFromPlot"),u=_("GetNearFieldSettings"),a=_("RunSimulationNearField"),v=_("PlotNearField"),m=_("GetNearFieldColorScale"),g=_("GetNearFieldRefinedSettings");return I(),le(We,{class:"column q-px-md"},{default:F(()=>[_i,Ne(n(l,null,null,512),[[Ue,!1]]),n(s),xi,n(u),$i,n(a),bi,n(v),Ni,n(m),Ui,n(g),Wi,n(Ie,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:F(()=>[n(E,{size:"xs",fab:"",icon:"keyboard_arrow_up",color:"primary"})]),_:1})]),_:1})}var Yi=Y(wi,[["render",Ii]]);export{Yi as default};
