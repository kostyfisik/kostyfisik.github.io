import{d as A}from"./InputWithUnits.28d3e368.js";import{h as Q,k as E,as as B,at as q,W as H,ad as I,au as V,c as T,m as O,z as U,av as G,aw as C,ap as N,_ as Y,q as j,ai as D,Y as z,ae as Z,a7 as x,Z as J,$ as k,a3 as M,a2 as K,a0 as w,a1 as P}from"./index.9041cdd0.js";import{F as X}from"./ReactiveChart.057ffced.js";const tt=[Q("g",{transform:"translate(-20,-20)"},[Q("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[Q("animateTransform",{attributeName:"transform",type:"rotate",from:"90 50 50",to:"0 50 50",dur:"1s",repeatCount:"indefinite"})])]),Q("g",{transform:"translate(20,20) rotate(15 50 50)"},[Q("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[Q("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"90 50 50",dur:"1s",repeatCount:"indefinite"})])])];var et=E({name:"QSpinnerGears",props:B,setup(t){const{cSize:S,classes:g}=q(t);return()=>Q("svg",{class:g.value,width:S.value,height:S.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},tt)}});const st=H({name:"RunSimulationSpectrum",setup(){const t=I(),S=V(),g=T({get:()=>t.state.simulationSetup.nmies.spectrum.isNmieRunning,set:o=>{o?t.commit("simulationSetup/markNmieAsStarted"):t.commit("simulationSetup/markNmieAsFinished")}}),R=T(()=>t.state.simulationSetup.nmies.spectrum.instance),v=T(()=>t.state.guiRuntime.sourceUnits);function F(o,f){let s=t.state.simulationSetup.current.fromWL,i=t.state.simulationSetup.current.toWL;s<o&&(s=o),i>f&&(i=f);const u=t.state.simulationSetup.current.pointsWL;if(v.value.endsWith("Hz")||v.value.endsWith("eV")){const l=1/s,p=1/i,d=(l-p)/(u-1),_=C(p,l,d);let h=[];for(const b of _)h.push(1/b);return h}const m=(i-s)/(u-1);return C(s,i,m)}function $(o,f){let s=[],i=[],u=[],m=[[],[]],l=[[],[]],p=[[],[]];return f.forEach(function(d){o.forEach(function(){m[d].push([]),l[d].push([]),p[d].push([])})}),{Qsca:s,Qabs:i,Qext:u,Qsca_n:m,Qabs_n:l,Qext_n:p}}function y(){if(g.value){console.log("Some Nmie is already running!");return}g.value=!0,setTimeout(()=>{j(()=>{t.commit("simulationSetup/copySetupFromGuiToCurrent");const o=t.state.simulationSetup.current.hostIndex,f=t.state.guiRuntime.safeFromWL,s=t.state.guiRuntime.safeToWL,i=F(f,s),u=G(t.state.simulationSetup.current.numberOfModesToPlot,1),m=C(0,1);let{Qsca:l,Qabs:p,Qext:d,Qsca_n:_,Qabs_n:h,Qext_n:b}=$(u,m);try{if(!t.state.simulationSetup.nmies.spectrum.instance)throw"ERROR! Scattnlay module was not loaded";const a=t.state.simulationSetup.nmies.spectrum.instance,W=D.exports.cloneDeep(t.state.simulationSetup.current.layers),n=performance.now();for(const c of i){a.SetWavelength(c),a.ClearTarget();for(const e of W)e.material.nSpline&&(e.n=e.material.nSpline.at(c)),e.material.kSpline&&(e.k=e.material.kSpline.at(c)),a.AddTargetLayerReIm(e.layerWidth*o,e.n/o,e.k/o);a.SetModeNmaxAndType(-1,-1),a.RunMieCalculation(),l.push(a.GetQsca()),p.push(a.GetQabs()),d.push(a.GetQext());for(const e of m)for(const L of u)a.SetModeNmaxAndType(L,e),a.RunMieCalculation(),_[e][L-1].push(a.GetQsca()),h[e][L-1].push(a.GetQabs()),b[e][L-1].push(a.GetQext())}const r=(performance.now()-n)/1e3;t.commit("simulationSetup/setNmieTotalRunTime",r),t.commit("plotRuntime/setQ",{WLs:i,Qsca:l,Qabs:p,Qext:d,Qsca_n:_,Qabs_n:h,Qext_n:b}),t.commit("plotRuntime/setWLsInUnits",v.value),t.commit("plotRuntime/updateNumberOfPlotsFromPreviousSimulations"),t.commit("plotRuntime/setCommonLabel",t.state.simulationSetup.current.plotLabel),t.commit("simulationSetup/setPlotLabel",""),t.commit("plotRuntime/updateSpectrumPlots")}catch(a){console.log(a)}g.value=!1})},100)}return O(R,()=>{R.value&&y()}),U(()=>{R.value&&(t.state.plotRuntime.spectrumPlots.data.length==0?y():t.state.plotRuntime.spectrumPlots.data[0].x.length||y())}),{router:S,isRunning:g,isNmieLoaded:R,runSpectrumSimulation:y,saveSpectrumSimulation(){const o=`# # You can open and plot this file using Python
# # (without manually removing this header, it will be skipped), see example below.
# import numpy as np
# from matplotlib import pyplot as plt
# data = np.genfromtxt('scattnlay-spectra.txt', skip_header=21, names=True, delimiter=', ')
# x = data[data.dtype.names[0]] # x-axis has units
# # Possible labels for spectrum data: Qsca, Qabs, Qext,
# # Qsca_E_dipole, etc. (see last comment before spectra data)
# a = data['Qsca']
# b = data['Qsca_E_dipole']
# c = data['Qsca_H_dipole']
# 
# plt.figure()
# plt.plot(x, a, label='Qsca')
# plt.plot(x, b, label='Qsca E dipole')
# plt.plot(x, c, label='Qsca H dipole')
# plt.legend()
# plt.xlabel(data.dtype.names[0].replace('_', ', '))
# plt.ylabel('Normalized cross-sections')
# plt.show()

`;let f="x";t.state.plotRuntime.spectrumPlots.layout.xaxis&&(f=String(t.state.plotRuntime.spectrumPlots.layout.xaxis.title));let s="# "+f+", Qsca, Qabs, Qext, ";const i=G(t.state.simulationSetup.current.numberOfModesToPlot,1),u=C(0,1);for(const n of i)for(const r of u){const c=r==0?"E":"H";s+="Qsca_"+c+"_"+N(n)+", ",s+="Qabs_"+c+"_"+N(n)+", ",s+="Qext_"+c+"_"+N(n)+", "}s=s.slice(0,-2),s+=`
`;let m="";const l=t.state.plotRuntime.WLsInUnits,p=t.state.plotRuntime.Qsca,d=t.state.plotRuntime.Qabs,_=t.state.plotRuntime.Qext,h=t.state.plotRuntime.Qsca_n,b=t.state.plotRuntime.Qabs_n,a=t.state.plotRuntime.Qext_n;for(let n=0;n<l.length;++n){let r=l[n].toString()+", "+p[n].toString()+", "+d[n].toString()+", "+_[n].toString()+", ";for(const c of i)for(const e of u)r+=h[e][c-1][n].toString()+", ",r+=b[e][c-1][n].toString()+", ",r+=a[e][c-1][n].toString()+", ";r=r.slice(0,-2),r+=`
`,m+=r}const W=new Blob([o+s+m],{type:"text/plain;charset=utf-8",endings:"native"});X.exports.saveAs(W,"scattnlay-spectra.txt")}}}}),at={class:"row items-baseline"},nt={class:"col-xs-12 col-sm-auto text-weight-bold text-center q-px-md q-py-sm"},ot=x("br",null,null,-1),it={class:"col-xs-grow col-sm q-px-xs"},lt={class:"row justify-xs-center justify-sm-start items-baseline"},rt={class:"col-auto"},ct={class:"col-auto q-px-md"};function ut(t,S,g,R,v,F){return z(),Z("div",at,[x("div",nt,[t.$store.state.guiRuntime.safeFromWL>t.$store.state.simulationSetup.gui.fromWL||t.$store.state.guiRuntime.safeToWL<t.$store.state.simulationSetup.gui.toWL?(z(),J(A,{key:0,anchor:"top middle",self:"center middle",class:"bg-amber-4 text-black shadow-4"},{default:k(()=>[M(" Will use materials"),ot,M(" spectrum range. ")]),_:1})):K("",!0),w(P,{loading:t.isRunning,disable:t.isRunning||!t.isNmieLoaded,color:"primary","no-caps":"",label:t.isNmieLoaded?"Run simulation":"Loading...",onClick:t.runSpectrumSimulation},{loading:k(()=>[w(et)]),_:1},8,["loading","disable","label","onClick"])]),x("div",it,[x("div",lt,[x("div",rt,[w(P,{color:"primary","no-caps":"",onClick:t.saveSpectrumSimulation},{default:k(()=>[M("Save")]),_:1},8,["onClick"])]),x("div",ct,[w(P,{icon:"arrow_forward",flat:"","text-color":"primary",label:"near-field",onClick:S[0]||(S[0]=$=>void t.router.push({path:"/nearfield"}))})])])])])}var ft=Y(st,[["render",ut]]);export{et as Q,ft as R};
