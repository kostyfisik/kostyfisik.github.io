import{W as A,ad as X,r as Q,c as S,U as ee,b2 as j,_ as B,b3 as oe,X as N,Y as v,ae as L,a0 as e,$ as o,a7 as i,a3 as d,Q as q,am as ne,a1 as U,Z as Y,a2 as H,a4 as z,m as Z,z as se,af as J,aj as T}from"./index.9041cdd0.js";import{Q as le,a as ie}from"./QCard.ef21fad4.js";import{d as V,f as re}from"./InputWithUnits.28d3e368.js";import{S as te,Q as de,a as O,b as R,d as x,c as ae}from"./QTable.e710f594.js";import{Q as me}from"./QSpace.b859c71b.js";import{F as ce,Q as ue,R as pe,a as K}from"./ReactiveChart.057ffced.js";import{Q as G,G as fe}from"./GetSourceParameters.9839ce19.js";import"./use-dark.1520c919.js";import"./format.ce9ff41f.js";import"./QList.9686cbf1.js";const ge=A({name:"MaterialsSelector",components:{ShowSpectrumRange:te},setup:function(){const t=X(),r=Q(!0),m=S(()=>t.state.simulationSetup.gui.fromWL),k=S(()=>t.state.simulationSetup.gui.toWL),h=[{name:"id",label:"",field:"id"},{name:"bookDivider",label:"State",field:"bookDivider"},{name:"bookName",label:"Material",field:"bookName"},{name:"spectrumRangeStart",label:"RangeStart",field:"spectrumRangeStart"},{name:"spectrumRangeEnd",label:"RangeEnd",field:"spectrumRangeEnd"},{name:"pageName",label:"Details",field:"pageName"},{name:"shelfDivider",label:"Group",field:"shelfDivider"},{name:"pageData",label:"file",field:"pageData"}];function b(s){if(s.lastIndexOf("\xB5m")==-1)return[s,""];const P=s.slice(0,s.lastIndexOf("\xB5m")-1).lastIndexOf(" "),c=s.slice(P+1,s.lastIndexOf("\xB5m")+2),$=s.replace(c,""),l=c.slice(0,c.lastIndexOf("-")),n=c.slice(c.lastIndexOf("-")+1,c.lastIndexOf("\xB5m")-1);return[$,l,n]}function f(s){if(s.lastIndexOf("(")==-1)return s;const P=s.lastIndexOf("("),c=s.slice(0,P-1),$=s.slice(P+1,s.length-1);return c+'<br><span style="font-size: 0.5em;">'+$+"</span>"}async function a(){let s=[];const c=await(await fetch("/refractiveindex.info-database/database/library.yml")).text(),l=await(await fetch("/tabulated.txt")).text(),n=await oe(c);let p=1;for(const _ of n){let W="",C="";for(const w of _.content)if(w.DIVIDER){W=w.DIVIDER;continue}else if(w.name){C=f(w.name);let I="",D="",g="";for(const y of w.content)if(y.DIVIDER){I=y.DIVIDER.replace("Experimental data:","").replace("Experimental data","");continue}else if(y.name){if(D=y.name,g=y.data,l.indexOf(g)==-1||I.includes("Model")||I.includes("model")||D.includes("Model")||D.includes("model"))continue;const F=b(D);s.push({id:p,shelfDivider:W,bookName:C,bookDivider:I,pageName:F[0],spectrumRangeStart:F[1],spectrumRangeEnd:F[2],pageData:g}),p=p+1}else console.log("###################### Unknown type in pageOrDivider",y)}else console.log("###################### Unknown type in bookOrDivider",w)}return s}const M=ee([]);a().then(s=>{M.push(...s),r.value=!1}),S(()=>t.state.guiRuntime.activatedMaterials);const E=Q("");return{columns:h,rows:M,loading:r,filter:E,fromWavelengthStore:m,toWavelengthStore:k,composeLabelFromPageData:j,addToSimulation(s){t.dispatch("guiRuntime/activateMaterial",M[s-1].pageData)},async downloadPageData(s){const c=await(await fetch("/refractiveindex.info-database/database/data/"+s)).text(),$=new Blob([c],{type:"text/plain;charset=utf-8",endings:"native"});ce.exports.saveAs($,j(s))}}}}),_e={class:"col-12 q-pa-md"},he={class:"q-mr-md"},we=i("br",null,null,-1),Se=["innerHTML"],ve={key:0};function Re(t,r,m,k,h,b){const f=N("ShowSpectrumRange");return v(),L("div",_e,[e(ae,{rows:t.rows,columns:t.columns,filter:t.filter,loading:t.loading,"rows-per-page-options":[3,12,24,0],dense:"",title:"Available materials","title-class":"text-h6","row-key":"id"},{top:o(()=>[i("div",he,[e(V,{anchor:"top end",self:"center middle"},{default:o(()=>[d(" Using a copy of RefractiveIndex.info website."),we,d(" Analytical models are not implemented. ")]),_:1}),e(q,{size:"sm",name:"o_info"})]),e(de,{modelValue:t.filter,"onUpdate:modelValue":r[1]||(r[1]=a=>t.filter=a),dense:"",debounce:"200",color:"primary"},ne({append:o(()=>[e(q,{name:"filter_alt"})]),default:o(()=>[t.filter?H("",!0):(v(),Y(V,{key:0,anchor:"top middle",self:"center middle"},{default:o(()=>[d("filter by any string")]),_:1}))]),_:2},[t.filter?{name:"after",fn:o(()=>[e(U,{flat:"",round:"",dense:"",icon:"cancel",onClick:r[0]||(r[0]=a=>t.filter="")})]),key:"0"}:void 0]),1032,["modelValue"]),e(me)]),header:o(a=>[e(O,{props:a},{default:o(()=>[e(R,{"auto-width":""}),e(R,{"auto-width":""}),e(R,{"auto-width":"",class:"text-left"},{default:o(()=>[d(" Label ")]),_:1}),e(R,{"auto-width":"",class:"text-left"},{default:o(()=>[d(" Range ")]),_:1}),e(R,{"auto-width":"",class:"text-left"},{default:o(()=>[d(" Material ")]),_:1}),e(R,{class:"text-left"},{default:o(()=>[d(" Details ")]),_:1})]),_:2},1032,["props"])]),body:o(a=>[e(O,{props:a},{default:o(()=>[e(x,{"auto-width":""},{default:o(()=>[e(V,{anchor:"top end",self:"center middle"},{default:o(()=>[d(" Add to simulation")]),_:1}),e(U,{size:"sm",color:"primary",round:"",dense:"",icon:"add",onClick:u=>t.addToSimulation(a.row.id)},null,8,["onClick"])]),_:2},1024),e(x,{"auto-width":""},{default:o(()=>[e(V,{anchor:"top end",self:"center middle"},{default:o(()=>[d(" Download *.yml file")]),_:1}),e(U,{flat:"",size:"md",color:"primary",icon:"download",padding:"xs 2px",onClick:u=>t.downloadPageData(a.row.pageData)},null,8,["onClick"])]),_:2},1024),e(x,{class:""},{default:o(()=>[d(z(t.composeLabelFromPageData(a.row.pageData)),1)]),_:2},1024),e(x,{"auto-width":""},{default:o(()=>[e(f,{"spectrum-range-start":a.row.spectrumRangeStart*1e3,"spectrum-range-end":a.row.spectrumRangeEnd*1e3},null,8,["spectrum-range-start","spectrum-range-end"])]),_:2},1024),e(x,{"auto-width":""},{default:o(()=>[i("div",{innerHTML:a.row.bookName},null,8,Se),e(V,{anchor:"top middle",self:"center middle"},{default:o(()=>[d(z(a.row.shelfDivider),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:o(()=>[d(z(a.row.bookDivider),1),a.row.bookDivider?(v(),L("span",ve,";\xA0")):H("",!0),d(z(a.row.pageName),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","loading"])])}var xe=B(ge,[["render",Re]]);const ye=A({name:"MaterialsActivated",components:{ShowSpectrumRange:te},setup:function(){const t=X(),r=S(()=>t.state.simulationSetup.gui.fromWL),m=S(()=>t.state.simulationSetup.gui.toWL);return{columns:[{name:"spectrumRangeStart",label:"RangeStart",field:"spectrumRangeStart"},{name:"spectrumRangeEnd",label:"RangeEnd",field:"spectrumRangeEnd"},{name:"name",label:"name",field:"name"},{name:"nSpline",nSpline:"nSpline",field:"nSpline"},{name:"kSpline",kSpline:"kSpline",field:"kSpline"}],fromWavelengthStore:r,toWavelengthStore:m,composeLabelFromPageData:j,deleteFromSimulation(h){t.commit("guiRuntime/deleteMaterial",h)}}}}),be={class:"col-12 q-pa-md"},ke={key:0},Pe={key:1},$e={key:0},Ie={key:1};function De(t,r,m,k,h,b){const f=N("ShowSpectrumRange");return v(),L("div",be,[e(ae,{rows:t.$store.state.guiRuntime.activatedMaterials,columns:t.columns,"rows-per-page-options":[0],"hide-pagination":"",dense:"",title:"Available materials","title-class":"text-h6","row-key":"name"},{header:o(a=>[e(O,{props:a},{default:o(()=>[e(R,{"auto-width":""}),e(R,{"auto-width":""},{default:o(()=>[d(" Plot ")]),_:1}),e(R,{"auto-width":"",class:"text-left"},{default:o(()=>[d(" Label ")]),_:1}),e(R,{"auto-width":"",class:"text-left"},{default:o(()=>[d(" Range ")]),_:1}),e(R,{class:"text-left"},{default:o(()=>[d(" Interpolator ")]),_:1})]),_:2},1032,["props"])]),body:o(a=>[a.row.name!="link"&&a.row.name!="nk-constant"&&a.row.name!="PEC"?(v(),Y(O,{key:0,props:a},{default:o(()=>[e(x,{"auto-width":""},{default:o(()=>[t.$store.state.simulationSetup.gui.layers.find(u=>u.material.name===a.row.name)?(v(),L("span",Pe,[e(V,{anchor:"top start",self:"bottom start"},{default:o(()=>[d(" Used in spectrum simulation")]),_:1}),e(U,{size:"sm",padding:"5px","text-color":"primary",round:"",dense:"",flat:"",icon:"push_pin",to:"/spectrum"})])):(v(),L("span",ke,[e(V,{anchor:"top middle",self:"bottom middle"},{default:o(()=>[d(" Delete")]),_:1}),e(U,{size:"sm",padding:"5px",color:"primary",round:"",dense:"",icon:"delete",onClick:u=>t.deleteFromSimulation(a.row.name)},null,8,["onClick"])]))]),_:2},1024),e(x,{"auto-width":""},{default:o(()=>[e(ue,{"model-value":a.row.isPlot,size:"sm",color:"primary",dense:"",onClick:u=>t.$store.commit("guiRuntime/toggleIsPlot",a.row.name)},null,8,["model-value","onClick"])]),_:2},1024),e(x,{"auto-width":"",class:"",onClick:u=>t.$store.commit("guiRuntime/toggleIsPlot",a.row.name)},{default:o(()=>[d(z(t.composeLabelFromPageData(a.row.name)),1)]),_:2},1032,["onClick"]),e(x,{"auto-width":"",onClick:u=>t.$store.commit("guiRuntime/toggleIsPlot",a.row.name)},{default:o(()=>[e(f,{"spectrum-range-start":a.row.spectrumRangeStart,"spectrum-range-end":a.row.spectrumRangeEnd},null,8,["spectrum-range-start","spectrum-range-end"])]),_:2},1032,["onClick"]),e(x,{class:"",onClick:u=>t.$store.commit("guiRuntime/toggleIsPlot",a.row.name)},{default:o(()=>[a.row.nSpline&&a.row.kSpline?(v(),L("span",$e,[e(q,{size:"sm",color:"green",name:"done"})])):(v(),L("span",Ie,[e(q,{size:"xs",color:"red",name:"do_not_disturb"})]))]),_:2},1032,["onClick"])]),_:2},1032,["props"])):H("",!0)]),_:1},8,["rows","columns"])])}var Ne=B(ye,[["render",De]]);const Le=A({name:"PlotMaterials",components:{ReactiveChart:pe},setup(){const t=X(),m=ee({data:[],layout:{margin:{l:0,r:40,b:50,t:30},xaxis:{title:""},yaxis:{title:"Refractive index"},showlegend:!0,legend:{orientation:"h",x:-.1,y:1.05}},config:{responsive:!0,displaylogo:!1}}),k=S(()=>t.state.guiRuntime.sourceUnits),h=S(()=>{var n;let l="";return(n=t.state.plotRuntime.spectrumPlots.layout.xaxis)!=null&&n.title&&(l=t.state.plotRuntime.spectrumPlots.layout.xaxis.title),l});m.layout.xaxis&&(m.layout.xaxis.title=h.value),Z(h,()=>{m.layout.xaxis&&(m.layout.xaxis.title=h.value)});const b=Q("material data"),f=Q(!0),a=Q(!0),u=Q(!0),M=S(()=>t.state.simulationSetup.gui.fromWL),E=S(()=>t.state.simulationSetup.gui.toWL),s=S(()=>t.state.simulationSetup.gui.pointsWL);function P(l){m.data.length=0;for(const n of l.activatedMaterials)if(!!n.isPlot&&!!n.nSpline){if(l.isPlotReN){const p={x:n.nSpline.xs.map(_=>T(_,l.sourceUnits)),y:n.nSpline.ys,mode:"markers",marker:{size:5},type:"scatter",name:"Re(n) "+n.name+" data"};m.data.push(p)}if(!!n.kSpline){if(l.isPlotImN){const p={x:n.kSpline.xs.map(_=>T(_,l.sourceUnits)),y:n.kSpline.ys,mode:"markers",marker:{size:5},type:"scatter",name:"Im(n) "+n.name+" data"};m.data.push(p)}if(l.isPlotInterpolation){let p=l.fromWL,_=l.toWL,W=l.pointsWL-1;m.layout.xaxis&&(m.layout.xaxis.range=[p,_]),l.plotRange=="material data"&&(p=n.nSpline.xs[0],_=n.nSpline.xs[n.nSpline.xs.length-1],W=1e3,m.layout.xaxis&&(m.layout.xaxis.range=void 0));const C=(_-p)/W,w=[],I=[],D=[];for(let g=0;g<W;++g)w.push(p+g*C),I.push(n.nSpline.at(p+g*C)),D.push(n.kSpline.at(p+g*C));if(w.push(_),I.push(n.nSpline.at(_)),D.push(n.kSpline.at(_)),l.isPlotReN){if(!n.nSpline)continue;const g={x:w.map(y=>T(y,l.sourceUnits)),y:I,type:"scatter",name:"Re(n) "+n.name+" interpolate"};m.data.push(g)}if(l.isPlotImN){if(!n.nSpline)continue;const g={x:w.map(y=>T(y,l.sourceUnits)),y:D,type:"scatter",name:"Im(n) "+n.name+" interpolate"};m.data.push(g)}}}}}function c(){P({activatedMaterials:t.state.guiRuntime.activatedMaterials,sourceUnits:k.value,fromWL:M.value,toWL:E.value,pointsWL:s.value,plotRange:b.value,isPlotReN:f.value,isPlotImN:a.value,isPlotInterpolation:u.value})}c();const $=S(()=>t.state.guiRuntime.activatedMaterials.filter(l=>l.isPlot).map(l=>l.name));return Z([$,b,f,a,u],()=>{c()}),se(()=>c()),{flexRowTitleStyle:re,materialPlots:m,isPlotReN:f,isPlotImN:a,isPlotInterpolation:u,plotRange:b}}}),Me={class:"row items-baseline"},Ve={class:"col-xs-12 col-sm-auto text-weight-bold text-center q-px-md q-py-sm"},We={class:"col-xs-grow col-sm"},Ce={class:"row justify-xs-center justify-sm-start items-center"},Qe=i("div",{class:"col-auto"},"select data:",-1),Ue={class:"col-auto"},Ee={class:"col-auto"},ze={class:"col-auto"},Te={class:"row items-baseline"},qe={class:"col-xs-12 col-sm-auto text-weight-bold text-center q-px-md q-py-sm"},Oe={class:"col-xs-grow col-sm"},Ae={class:"row justify-xs-center justify-sm-start items-baseline"},Be=i("div",{class:"col-auto q-pr-md"},"interpolation range from:",-1),Fe={class:"col-auto"},Ge={class:"q-gutter-x-md"};function je(t,r,m,k,h,b){const f=N("ReactiveChart");return v(),L("div",null,[i("div",Me,[i("div",Ve,[i("div",{style:J(t.flexRowTitleStyle)},"Plot options",4)]),i("div",We,[i("div",Ce,[Qe,i("div",Ue,[e(G,{modelValue:t.isPlotReN,"onUpdate:modelValue":r[0]||(r[0]=a=>t.isPlotReN=a)},{default:o(()=>[d("Re(n)")]),_:1},8,["modelValue"])]),i("div",Ee,[e(G,{modelValue:t.isPlotImN,"onUpdate:modelValue":r[1]||(r[1]=a=>t.isPlotImN=a)},{default:o(()=>[d("Im(n)")]),_:1},8,["modelValue"])]),i("div",ze,[e(G,{modelValue:t.isPlotInterpolation,"onUpdate:modelValue":r[2]||(r[2]=a=>t.isPlotInterpolation=a)},{default:o(()=>[d("Interpolation")]),_:1},8,["modelValue"])])])])]),i("div",Te,[i("div",qe,[i("div",{style:J(t.flexRowTitleStyle)},null,4)]),i("div",Oe,[i("div",Ae,[Be,i("div",Fe,[i("div",Ge,[e(K,{modelValue:t.plotRange,"onUpdate:modelValue":r[3]||(r[3]=a=>t.plotRange=a),dense:"",size:"sm",val:"material data",label:"material data"},null,8,["modelValue"]),e(K,{modelValue:t.plotRange,"onUpdate:modelValue":r[4]||(r[4]=a=>t.plotRange=a),dense:"",size:"sm",val:"simulation settings",label:"simulation settings"},null,8,["modelValue"])])])])])]),e(f,{chart:t.materialPlots},null,8,["chart"])])}var He=B(Le,[["render",je]]);const Xe=A({name:"MaterialsPage",components:{MaterialsSelector:xe,GetSourceParameters:fe,MaterialsActivated:Ne,PlotMaterials:He}}),Ye=i("div",{class:"q-ma-sm"},null,-1),Ze=i("div",{class:"q-ma-xs"},null,-1),Je=i("div",{class:"q-ma-xs"},null,-1),Ke=i("div",{class:"q-ma-xs"},null,-1),et=i("div",{class:"q-ma-lg"},null,-1);function tt(t,r,m,k,h,b){const f=N("MaterialsSelector"),a=N("GetSourceParameters"),u=N("router-link"),M=N("MaterialsActivated"),E=N("PlotMaterials");return v(),Y(le,{class:"col-12 q-px-md"},{default:o(()=>[Ye,e(f),Ze,e(u,{to:"/spectrum"},{default:o(()=>[e(a,{"is-info-mode":!0})]),_:1}),e(M),Je,e(E),Ke,et,e(ie,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:o(()=>[e(U,{size:"xs",fab:"",icon:"keyboard_arrow_up",color:"primary"})]),_:1})]),_:1})}var ut=B(Xe,[["render",tt]]);export{ut as default};
